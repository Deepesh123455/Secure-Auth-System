services:
  # ==========================================
  # BACKEND SERVICE (Target: Builder Stage)
  # ==========================================
  backend:
    container_name: app-backend
    build:
      context: ./backend
      dockerfile: Dockerfile
      # IMPORTANT: Hum 'builder' stage use kar rahe hain kyunki 'runner' stage 
      # se humne dev dependencies (nodemon etc.) hata di thi optimization ke liye.
      target: runner 
      
   
    
   
    ports:
      - "5000:5000"
    
    networks:
      - app-network
    
    env_file:
      - ./backend/.env
    
    
      
    environment:
      - NODE_ENV=production
      - PORT=5000
    
    # Dev mein agar crash ho to restart mat karo, error log padhne do
    restart: always
    
    # Healthcheck (Optimized for silence & speed)
    healthcheck:
      test: ["CMD", "wget", "-q", "--spider", "http://localhost:5000"]
      interval: 10s
      timeout: 5s
      retries: 3

  # ==========================================
  # FRONTEND SERVICE (Target: Development Stage)
  # ==========================================
  frontend:
    container_name: app-frontend
    build:
      context: ./frontend/Auth System
      dockerfile: Dockerfile
      # Matches Stage 1 of Frontend Dockerfile
      target: runner
    
    # ðŸ”„ HOT RELOAD MAGIC
    
    
    ports:
      - "80:80"
    
    networks:
      - app-network
    
    # Backend ready hone ka wait karega
    depends_on:
      backend:
        condition: service_healthy

    

# ==========================================
# NETWORKS
# ==========================================
networks:
  app-network:
    driver: bridge